import re
import pandas as pd

# 원본 텍스트 입력
text = """신규 캐릭터: 스커크, [전반], 달리아, [전반]
신규 캐릭터: 에스코피에, [전반], 이파, [전반]
신규 캐릭터: 바레사, [전반], 얀사, [전반]
신규 캐릭터: 유메미즈키 미즈키, [전반], [상시]
신규 캐릭터: 마비카, [전반], 시틀라리, [전반], 남연, [후반], 여행자(불)
신규 캐릭터: 차스카, [전반], 올로룬, [전반]
신규 캐릭터: 실로닌, [전반]
신규 캐릭터: 말라니, [전반], 키니치, [후반], 카치나, [전반]
신규 캐릭터: 에밀리, [후반]
신규 캐릭터: 클로린드, [전반], 시그윈, [후반], 세토스, [전반]
신규 캐릭터: 아를레키노, [전반]
신규 캐릭터: 치오리, [전반]
신규 캐릭터: 한운, [전반], 가명, [전반]
신규 캐릭터: 나비아, [전반], 슈브르즈, [후반]
신규 캐릭터: 푸리나, [전반], 샤를로트, [전반]
신규 캐릭터: 느비예트, [전반], 라이오슬리, [후반]
신규 캐릭터: 리니, [전반], 리넷, [전반], 프레미네, [후반], 여행자(물)
신규 캐릭터: [157]
신규 캐릭터: 키라라, [전반]
신규 캐릭터: 백출, [후반], 카베, [후반]
신규 캐릭터: 데히야, [전반], [184], 미카, [후반]
신규 캐릭터: 알하이탐, [전반], 요요, [전반]
신규 캐릭터: 방랑자, [전반], [198], 파루잔, [전반]
신규 캐릭터: 나히다, [전반], 레일라, [후반]
신규 캐릭터: 사이노, [전반], 닐루, [후반], 캔디스, [전반]
신규 캐릭터: 타이나리, [전반], [224], 콜레이, [전반], 도리, [후반], 여행자(풀)
신규 캐릭터: 시카노인 헤이조
신규 캐릭터: 야란, [전반], 쿠키 시노부, [후반]
신규 캐릭터: 카미사토 아야토, [전반]
신규 캐릭터: 야에 미코, [전반]
신규 캐릭터: 신학, [전반], 운근, [전반]
신규 캐릭터: 아라타키 이토, [후반], 고로, [후반]
신규 캐릭터: 토마, [후반], 에일로이, [295]
신규 캐릭터: 라이덴 쇼군, [전반], 쿠죠 사라, [전반], 산고노미야 코코미, [후반], 에일로이, [305]
신규 캐릭터: 카미사토 아야카, [전반], 요이미야, [후반], 사유, [후반], 여행자(번개)
신규 캐릭터: 카에데하라 카즈하, [후반]
신규 캐릭터: 유라, [후반], 연비, [전반]
신규 캐릭터: 로자리아, [후반]
신규 캐릭터: 소, [전반], 호두, [후반]
신규 캐릭터: 알베도, [전반], 감우, [후반]
신규 캐릭터: 타르탈리아, [전반], 디오나, [전반], 종려, [후반], 신염, [전반]
신규 캐릭터: 벤티, [전반], 클레, [후반]
신규 캐릭터: [360], 콜롬비나, [361], [362], [363], 산드로네, 니콜·라인, [364], 바르카, [365], [366], 꼬마 두린, [367], [368], [369], [370], [371]
신규 캐릭터: [380]"""

# 결과 저장용
results = []

# 줄 단위로 처리
for line in text.splitlines():
    line = re.sub(r"신규 캐릭터:\s*", "", line)  # "신규 캐릭터:" 제거
    tokens = [t.strip() for t in line.split(",") if t.strip()]  # 쉼표 기준 분리 및 공백 제거

    name_stack = []
    for token in tokens:
        # [숫자] 필터링
        if re.match(r"\[\d+\]", token):
            continue

        # 출현 시기 처리
        if token in ["[전반]", "[후반]", "[상시]"]:
            season = token.strip("[]")
            for name in name_stack:
                results.append({"캐릭터명": name, "출현 시기": season})
            name_stack.clear()
        else:
            name_stack.append(token)

# 데이터프레임 저장
df = pd.DataFrame(results)
df.to_csv("신규_캐릭터_출현시기3.csv", index=False, encoding='utf-8-sig')
print("CSV 저장 완료!")
